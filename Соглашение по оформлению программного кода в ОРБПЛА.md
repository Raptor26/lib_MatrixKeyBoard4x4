email  
Soar360@live.com

key  
GBPduHjWfJU1mZqcPM3BikjYKF6xKhlKIys3i1MU2eJHqWGImDHzWdD6xhMNLGVpbP2M5SN6bnxn2kSE8qHqNY5QaaRxmO3YSMHxlv2EYpjdwLcPwfeTG7kUdnhKE0vVy4RidP6Y2wZ0q74f47fzsZo45JE2hfQBFi2O9Jldjp1mW8HUpTtLA2a5/sQytXJUQl/QKO0jUQY4pa5CCx20sV1ClOTZtAGngSOJtIOFXK599sBr5aIEFyH0K7H4BoNMiiDMnxt1rD8Vb/ikJdhGMMQr0R4B+L3nWU97eaVPTRKfWGDE8/eAgKzpGwrQQoDh+nzX1xoVQ8NAuH+s4UcSeQ==

***
# Соглашение по оформлению программного кода в ОРБПЛА
*Данный документ отражает основные требования при написании программного кода для микроконтроллеров в ОРБПЛА*
***
- [youtube](https://www.youtube.com/watch?v=T7fdEJreSrg)
# Содержание:

- [Правила именование модулей программного кода](#FourName:)


## Правила именования модулей программного кода:

#### Каждому модулю соответствует пара файлов:

- с расширением `.c`
- с расширением `.h`

Модули именуются следующим образом:


#### Первичное обозначение:

 - Если файл принадлежит текущему проекту, то присваивается аббревиатура `Prj`;
 - Если файл принадлежит библиотеке, то присваивается аббревиатура `Lib`.


#### Вторичное обозначение:

 - Если модуль работает с аппаратной частью, то присваивается буква `H` (Hardware);
 - Если модуль работает только с данными, то присваивается буква `A` (Abstract). (замечание: модуль, имеющий `Lib` в качестве первичного обозначения, в качестве вторичного обозначения может иметь или `H`, или `A`. Модуль, имеющий в качестве первичного обозначения `Prj`, в качестве вторичного обозначения может иметь только `H`)


#### Третичное обозначение:

Если модуль относится к текущему проекту  (имеет первичное обозначение `Prj`), то третичное обозначение отсутствует.

Если модуль относится к библиотеке (*имеет первичное обозначение* `Lib`), то он должен иметь аббревиатуру, которая будет уникальна только для данного модуля. 

- В случае, если у модуля первичное и вторичное обозначение имеет вид `Lib_H`, то аббревиатуру следует брать из названия микросхемы, которую данный модуль будет использовать. Если не получается выделить аббревиатуру из названия микросхемы, то следует воспользоваться генератором паролей для генерирования уникальной аббревиатуры. 

- В случае, если если у модуля первичное и вторичное обозначение имеет вид `Lib_A`, следует сразу использовать генератор паролей для генерирования уникальной аббревиатуры.  

###### *Рекомендации по генерированию аббревиатур:*

	-аббревиатура должна состоять из 4-х символов
	-крайний символ должен быть цифрой;
 

#### <a name="FourName"></a> Четвертичное обозначение:



Должно отражать что именно делает данный модуль. 

***
######*Примеры четвертичных обозначений:*
- `flash_memory` указывает на то, что данный модуль предназначен для работы с flash памятью;
- `spi` указывает на то, что данный модуль предназначен для работы с шиной SPI;
- `i2c` указывает на то, что данный модуль предназначен для работы с шиной I2C; 
- `main` указывает на то, что данный модуль является главной функцией проекта;
- `interrupts` указывает на то, что данный модуль обрабатывает прерывания.
***

####*Примеры полного названия модулей:*
`Lib_H_w15q64_flash_memory.c` где:

- `Lib` - первичное обозначение;
- `H` - вторичное обозначение;
- `w15q64` - третичное обозначение;
- `flash_memory` - четвертичное обозначение.
***
`Lib_H_pic24e_spi.c` где:

- `Lib` - первичное обозначение;
- `H` - вторичное обозначение;
- `pic24e` - третичное обозначение;
- `spi` - четвертичное обозначение.
***

###### *Замечание по третичным обозначениям модулей:*
	третичное обозначение отсутствует у модулей, 
	обозначение которых начинается с "Prj";
***
`Prj_H_main.c` где:

- `Prj` - первичное обозначение;
- `H` - вторичное обозначение;
- `_` - третичное обозначение - отсутствует:
- `main` - четвертичное обозначение.
***
`Prj_H_configurations_bits.c` где:

- `Prj` - первичное обозначение;
- `H` - вторичное обозначение;
- `_` - третичное обозначение - отсутствует:
- `configurations_bits` - четвертичное обозначение.
***
`Prj_H_interrupts.c` где:

- `Prj` - первичное обозначение;
- `H` - вторичное обозначение;
- `_` - третичное обозначение - отсутствует:
- `interrupts` - четвертичное обозначение.
***

[Подробный пример именования программных модулей](#Пример-именования-программных-модулей)




## Правила именования элементов программного модуля

Библиотечному модулю следует присвоить аббревиатуру, которая будет гарантировать уникальность имени модуля и имен функций, которые данный модуль содержит. Один из вариантов присвоения аббревиатуры – это выделение аббревиатуры из названия микросхемы к которой относится данный программный модуль. Если нет возможности выделить аббревиатуру из названия микросхемы, то следует ввести аббревиатуру самостоятельно.

*Рекомендации* по присвоению аббревиатур следующие:

- количество символов аббревиатуры – 4;
- аббревиатура заканчивается цифрой (улучшает читаемость программного кода);
- аббревиатура генерируется с помощью генератора паролей.

Правила именования функций, глобальных переменных, именованных констант следующие:

- Каждая функция, принадлежащая данному программному модулю, начинается с аббревиатуры программного модуля;
- Каждая именованная константа, принадлежащая данному программному модулю, начинается с аббревиатуры программного модуля;
- Каждый перечисляемый тип, принадлежащая данному программному модулю, начинается с аббревиатуры программного модуля;
- Каждый новый тип данных, объявленный через `typedef` и принадлежащий данному программному модулю, начинается с аббревиатуры программного модуля [см. пример](#Пример-именования-элементов-программного-модуля);
- Каждый новый тип данных, объявленный через `typedef`, заканчивается символами `_t` [см. пример](#Пример-именования-элементов-программного-модуля);

[Пример именования элементов программного модуля](#Пример-именования-элементов-программного-модуля)




## Правила именования переменных

Имена всех переменных, в том числе и локальных, начинаются с буквы в нижнем регистре. Имя переменной должно отражать то, с какими именно данными работает переменная.

Примеры:  

- arr – массив (array);
- addr – адрес (address);
- p – указатель (pointer);
- data – данные;

***
***
***


# Примеры программного кода

### *Пример именования программных модулей:*

	/**
	 * "Prj": 	Показывает, что данный модуль имеет отношение к проекту
	 * "H":		Показывает, что данный модуль работает с аппаратной частью
	 * "main":	Имя модуля
	 */
	Prj_H_main.c 			
	Prj_H_main.h
***
	/** 
	 * "Prj":	Показывает, что данный модуль имеет отношение к проекту
	 * "H":		Показывает, что данный модуль работает с аппаратной частью
	 * "interrupts":	Имя модуля
	 */
	Prj_H_interrupts.c
	Prj_H_interrupts.h
***
	/** 
	 * "Lib":	Показывает, что данный модуль является библиотекой и может быть 
	 *			использован в разных проектах
	 * "H":		Показывает, что данный модуль работает с аппаратной частью
	 * "w15q64":	Показывает, к какой аппаратной части относится данный модуль 
	 *				(в частности, относится к flash памяти, которая имеет
	 *				обозначение "w15q64")
	 * "flash_memory":	Имя модуля (должно информативно отражать что данный
	 *					модуль выполняет)
	 * Lib_H_W15Q64_Flash_Memory:	Название папки модуля, в котором хранится 
	 *								библиотечный модуль в виде пары файлов с 
	 *								расширениями ".c" и ".h"
	 */
	Lib_H_w15q64_flash_memory.c
	Lib_H_w15q64_flash_memory.h
***
	/** 
	 * "Lib":	Показывает, что данный модуль является библиотекой и может быть 
	 *			использован в разных проектах
	 * "H":		Показывает, что данный модуль работает с аппаратной частью
	 * "pic24e":	Показывает, что данный модуль работает с аппаратной частью 
	 *				микроконтроллера "pic24e"
	 * "spi":	Имя модуля (показывает, что данный модуль работает с шиной 
	 *			данных "SPI")
	 * Lib_H_PIC24E_SPI:	Название папки модуля, в котором хранится 
	 *						библиотечный модуль в виде пары файлов с 
	 *						расширениями ".c" и ".h"
	 */
	Lib_H_pic24e_spi.c
	Lib_H_pic24e_spi.h
***
	/** 
	 * "Lib":	Показывает, что данный модуль является библиотекой и может быть 
	 *			использован в разных проектах
	 * "H":		Показывает, что данный модуль работает с аппаратной частью
	 * "pic24e":	Показывает, что данный модуль работает с аппаратной частью 
	 *				микроконтроллера "pic24e"
	 * "i2c":	Имя модуля (показывает, что данный модуль работает с шиной 
	 *			данных "I2C")
	 * Lib_H_PIC24E_I2C:	Название папки модуля, в котором хранится 
	 *						библиотечный модуль в виде пары файлов с 
	 *						расширениями ".c" и ".h"
	 */
	Lib_H_pic24e_i2c.c
	Lib_H_pic24e_i2c.h
***
	/**
	 * "Lib":	Показывает, что данный модуль является библиотекой и может быть 
	 *			использован в разных проектах
	 * "A":		Показывает, что данный модуль работает только с данными 
	 *			(т.е. не работает с периферией)
	 * "quaternion":	Имя модуля
	 * Замечание:	Если модуль имеет обозначение "A" - Abstract, то у модуля 
	 *				не может быть обозначения, указывающего на аппаратную часть 
	 *				(например, не может быть обозначения, подобного "pic24e" из 
	 *				предыдущего примера)
	 * Lib_A_Quaternion:	Название папки модуля, в котором хранится 
	 *						библиотечный модуль в виде пары файлов с 
	 *						расширениями ".c" и ".h"
	 */
	Lib_A_quaternion.c
	Lib_A_quaternion.h
*** 
***
   

### *Пример именования элементов программного модуля:*
	/**
	 * "W15Q64":	Аббревиатура программного модуля. Данная аббревиатура взята
	 *				из документации на микросхему flash памяти
	 */
	void W15Q64_ReadStatRegs(W15Q64spi_t *spi,
	                         W15Q64statRegs_t *status)
***					 
	/**
	 * "W15Q64":	Аббревиатура программного модуля. Данная аббревиатура взята
	 * 				из документации на микросхему flash памяти
	 */						 
	void W15Q64_FastReadData(W15Q64spi_t *spi,
	                         uint32_t addr,
	                         uint8_t *pRxData,
	                         uint16_t cnt);
***					 
	/**
	 * "W15Q64":	Аббревиатура программного модуля. Данная аббревиатура взята
	 * 				из документации на микросхему flash памяти
	 * "W15Q64statRegs_t":	Новый тип данных, принадлежащий прогрммному модулю
	 */						 
	typedef struct {
	    _Bool reg1[8]; //            Status Register 1 array
	    _Bool reg2[8]; //            Status Register 2 array
	} W15Q64statRegs_t; //  Структура содержит два массива для хранения значений 
	//                      Status Register 1 and Status Register 2
***
	/**
	 *	"ZC14":	Аббревиатура программного модуля. Данная аббревиатура сгенерирована 
	 *			генератором паролей
	 * 	"W15Q64statRegs_t":	Новый тип данных, принадлежащий внешнему программному модулю
	 *	"ZC14blackBox_t":	Новый тип данных, принадлежащий текущему программному модулю
	 *	В функции используются два новых (пользовательсих) типа данных с разными 
	 *	обозначениями. Тип данных "ZC14blackBox_t" относится к программному модулю, 
	 *	в котором объявлена функция "ZC14_ReadData". Тип данных "W15Q64spi_t" относится 
	 *	к модулю, который подключен как внешний (через диррективу "#include") по 
	 *	отношению к модулю, в котором объявлена функция "ZC14_ReadData".
	 */
	uint16_t ZC14_ReadData(W15Q64spi_t *spi,
	                       ZC14blackBox_t *Bb,
	                       _Bool *statReg,
	                       uint32_t addr);		
***
***

### *Примеры именования переменных*
	/**
	 *	"p":	Говорит о том, что данная переменная является указателем
	 * 	"Arr":	Говорит о том, что данная переменная работает с массивом
	 *	"*pArr"	Говорит о том, что данная переменная является указателем на массив данных 
	 *			(символ "*" говорит о том, что данная переменная является указателем, а 
	 *			указатели и массивы тесно связаны между собой)
	 *	"uint8_t *pArr"	Говорит о том, что данная переменная является указателем на 
	 *					массив данных типа "uint8_t"
	 */
	uint8_t *pArr;
***	
	/**
	 *	"addr":	Говорит о том, что данная переменная является адресом (в памяти куда 
	 *			будут записываться данные)
	 */
	uint32_t addr;								 
***						 
	/**
	 *	"statReg":	Говорит о том, что данная переменная является регистром статуса
	 *  "*statReg":	Говорит о том, что данная переменная является регистром статуса, 
	 *				представляющим из себя массив (символ "*" говорит о том, что данная переменная 
	 *				является указателем, а указатели и массивы тесно связаны между собой)
	 *	_Bool *statReg:	Говорит о том, что данная переменная является регистром статуса, 
	 *					представляющим из себя массив типа "bool"
	 */
	_Bool *statReg;						 
***				 
	/**
	 *	"cnt":	Говорит о том, что данная переменная является счетчиком
	 *	"size_t":	Беззнаковый целочисленный тип данных, его разрядность зависит от 
	 *				разрядности процессора т.е. если процессор 16 битный, то 
	 *				переменная типа "size_t" будет занимать 16 бит, если процессор 
	 *				32 битный, то переменная типа "size_t" будет занимать 32 бита. 
	 *				По индукции правило распространяется на процессоры другой разрядности				
	 */
	size_t cnt;						 
***
	/**
	 *	Warning:	Пример объявления переменных в прототипе функции
	 *	"void* data":	Указатель на тип данных "void"
	 *	"uint8_t *pArr"	Указатель на массив данных типа "uint8_t". (символ "*" говорит о 
	 *					том, что данная переменная является указателем, а указатели
	 *					и массивы тесно связаны между собой)				
	 *	"size_t size"	Переменная типа "size_t" (см. предыдущий пример)
	 */
	uint8_t *ZC14_BytesToVar(void* data, uint8_t *pArr, size_t size)